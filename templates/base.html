{% load static %}
<!DOCTYPE html>
<html lang="en" data-theme="cupcake" >
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}EarthShop{% endblock %}</title>
    <link href="{% static 'css/output.css' %}" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    {% block extra_head %}{% endblock %}

    
</head>
<body class="min-h-screen bg-base-200">
    <!-- Drawer for sidebar (responsive, mobile-friendly) -->
    <div class="drawer lg:drawer-open">
        <input id="sidebar-toggle" type="checkbox" class="drawer-toggle" />
        <div class="drawer-content flex flex-col">
            <!-- Navbar with Avatar -->
            <div class="navbar bg-base-100 shadow-md sticky top-0 z-10">
                <div class="flex-none lg:hidden">
                    <label for="sidebar-toggle" class="btn btn-square btn-ghost">
                        <i class="fa-solid fa-bars text-xl"></i>
                    </label>
                </div>
                <div class="flex-1">
                    <a href="/" class="btn btn-ghost text-xl font-bold  transition delay-150 duration-300 ease-in-out hover:-translate-y-1 hover:scale-110 hover:bg-indigo-500">ðŸŒ± EarthShop</a>
                </div>
                <div class="flex-none gap-2 items-center">
                    <button id="themeToggle" class="btn btn-outline btn-sm" title="Toggle theme">
                        <i class="fa-solid fa-moon"></i>
                    </button>
                    <div class="dropdown dropdown-end">
                        <label tabindex="0" class="btn btn-circle avatar">
                            <div class="w-52 rounded-full ring ring-primary ring-offset-4 ring-offset-base-100" >
                              <abbr title="Heyy Boss ðŸ‘‘ Are You Enjoying Your Day ">  <img src="{% static 'images/earthshop.jpeg' %}" alt="User Avatar" class="rounded-full" />  </abbr>
                            </div>
                        </label>
                        <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 p-2 shadow-lg bg-base-100 rounded-box w-52 transition-opacity duration-300 opacity-0 group-hover:opacity-100">
                            {% if user.is_authenticated %}
                                <li><span class="text-sm text-base-content/70 p-2">Hi, {{ user.username }}</span></li>
                                <li><a href="{% url 'logout' %}" class="btn btn-error btn-sm w-full mt-2">Logout</a></li>
                            {% else %}
                                <li><a href="{% url 'login' %}" class="btn btn-success btn-sm w-full">Login</a></li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <main class="container mx-auto py-6 px-4 flex-grow">
                {% block content %}{% endblock %}
            </main>
            <!-- Footer -->
            <footer class="footer footer-center bg-base-100 text-base-content/70 py-4 border-t border-base-300">
                <p>&copy; {{ year|default:2025 }} ðŸŒ± EarthShop</p>
            </footer>
        </div>
        
        <!-- Sidebar -->
       <!-- Sidebar component for EarthShop (Tailwind + DaisyUI friendly) -->
<!-- Put this inside your main layout where the drawer toggle exists -->
<div class="drawer lg:drawer-open">
  <input id="sidebar-toggle" type="checkbox" class="drawer-toggle" />

  <!-- Main content (keeps page layout) -->
  <div class="drawer-content">
    <!-- Your page content goes here -->
  </div>

  <!-- Sidebar -->
  <div class="drawer-side">
    <label for="sidebar-toggle" class="drawer-overlay"></label>

    <aside class="w-64 lg:w-42 h-screen bg-gradient-to-b from-slate-800 via-slate-700 to-slate-600 text-slate-50 shadow-xl p-5 flex flex-col">
      <!-- Header -->
      <div class="flex items-center justify-between mb-4">
        <a href="/" class="flex items-center gap-3">
          <span class="text-2xl">ðŸŒ±</span>
          <span class="text-xl font-bold tracking-tight">.EarthShop</span>
        </a>

        <!-- close button visible on small screens -->
        <label for="sidebar-toggle" class="btn btn-ghost btn-sm lg:hidden">
          <i class="fa-solid fa-xmark text-lg"></i>
        </label>
      </div>
      
      <!-- Search & Product quick controls -->
      <div class="mb-4">
        <label for="sidebar-search" class="sr-only">Search products</label>
        <input id="sidebar-search"
               type="search"
               placeholder="Search products, SKUs..."
               class="w-full input input-sm bg-slate-700 text-slate-50 placeholder-slate-300 border-0 focus:ring-2 focus:ring-sky-400"
               oninput="filterSidebarProducts(this.value)">
      </div>

      <!-- Scrollable menu area -->
      <nav id="sidebar-scroll"
           class="flex-1 overflow-y-auto pr-2 space-y-4 scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-800">
        <!-- Products group -->
        <div class="space-y-2">
          <h3 class="text-xs text-slate-200 font-semibold uppercase tracking-wider mb-1">Products</h3>
<details>
                            
            <summary class="flex items-center justify-between px-3 py-2 rounded-md cursor-pointer hover:bg-slate-700">
              <div class="flex items-center gap-3">
                <i class='fas fa-clipboard-check' style='font-size:24px'></i>
                <span class="font-medium">Products</span>
              </div>
              <i class="fa-solid fa-chevron-down transition-transform group-open:rotate-180"></i>
            </summary>
<ul class="mt-2 px-2 grid gap-2">
              <li><a href="{% url 'products:add_product' %}" class="block px-3 py-2 rounded-md hover:bg-slate-700">Add Product</a></li>
              <li><a href="{% url 'products:product_list' %}" class="block px-3 py-2 rounded-md hover:bg-slate-700">Products List</a></li>
             <li><a href="{% url 'products:add_category' %}" class="block px-3 py-2 rounded-md hover:bg-slate-700">Add Category</a></li>
          
            </ul>
          </details>
        
     





          <!-- Live-filtered product list (scrollable even inside outer area) -->
          <div>
            
            <ul id="product-list" class="space-y-1">
              <!-- Example items - ideally render via template loop -->
              {% for p in recent_products %}
              <li class="product-item" data-name="{{ p.name|lower }} {{ p.sku|lower }}">
                <a href="{% url 'products:detail' p.pk %}" class="flex items-center justify-between px-3 py-2 rounded-md hover:bg-slate-700">
                  <div class="flex items-center gap-3">
                    <img src="{{ p.thumbnail_url }}" alt="{{ p.name }}" class="w-8 h-8 rounded object-cover">
                    <div>
                      <div class="text-sm font-medium">{{ p.name }}</div>
                      <div class="text-xs opacity-70">{{ p.sku }}</div>
                    </div>
                  </div>
                  <div class="text-sm">
                    <span class="badge badge-sm">{{ p.stock }}</span>
                  </div>
                </a>
              </li>
              {% empty %}
              <li class="px-3 py-2 text-sm text-slate-300">No recent products</li>
              {% endfor %}
            </ul>
          </div>
        </div>


        <!-- Customers -->
        <div>
          <h3 class="text-xs text-slate-200 font-semibold uppercase tracking-wider mb-1">Customers</h3>
          <details class="group rounded-md">
            <summary class="flex items-center justify-between px-3 py-2 rounded-md cursor-pointer hover:bg-slate-700">
              <div class="flex items-center gap-3">
                <i class="fa-solid fa-users w-4"></i>
                <span class="font-medium">Customers</span>
              </div>
              <i class="fa-solid fa-chevron-down transition-transform group-open:rotate-180"></i>
            </summary>

            <ul class="mt-2 px-2 grid gap-2">
              <li><a href="{% url 'customers:add' %}" class="block px-3 py-2 rounded-md hover:bg-slate-700">Add Customer</a></li>
              <li><a href="{% url 'customers:list' %}" class="block px-3 py-2 rounded-md hover:bg-slate-700">Customer List</a></li>
            </ul>
          </details>
        </div>


        <!-- Banking -->
         <div>
          <h3 class="text-xs text-slate-200 font-semibold uppercase tracking-wider mb-1">Banking</h3>
          <details class="group rounded-md">
            <summary class="flex items-center justify-between px-3 py-2 rounded-md cursor-pointer hover:bg-slate-700">
              <div class="flex items-center gap-3">
                </i>  <i class="fa fa-money-bill-alt"></i> 
                <span class="font-medium">Banking</span>
              </div>
              <i class="fa-solid fa-chevron-down transition-transform group-open:rotate-180"></i>
            </summary>

            <ul class="mt-2 px-2 grid gap-2">
              <li><a href="{% url 'banking:add' %}" class="block px-3 py-2 rounded-md hover:bg-slate-700">Add Bank</a></li>
              <li><a href="{% url 'banking:list' %}" class="block px-3 py-2 rounded-md hover:bg-slate-700">Banks List</a></li>
            </ul>
          </details>
        </div>



        <!-- Sales & Expenses -->
        <div>
          <h3 class="text-xs text-slate-200 font-semibold uppercase tracking-wider mb-1">Sales & Expenses</h3>
          <details class="group rounded-md">
            <summary class="flex items-center justify-between px-3 py-2 rounded-md cursor-pointer hover:bg-slate-700">
              <div class="flex items-center gap-3">
                <i class="fa-solid fa-receipt w-4"></i>
                <span class="font-medium">Sales & Expenses</span>
              </div>
              <i class="fa-solid fa-chevron-down transition-transform group-open:rotate-180"></i>
            </summary>

            <ul class="mt-2 px-2 grid gap-2">
              <li><a href="{% url 'sales:create_invoice' %}" class="block px-3 py-2 rounded-md hover:bg-slate-700">Create Invoice</a></li>
              <li><a href="{% url 'sales:invoice_list' %}" class="block px-3 py-2 rounded-md hover:bg-slate-700">Invoices List</a></li>
              <li><a href="{% url 'expenses:add' %}" class="block px-3 py-2 rounded-md hover:bg-slate-700">Add Expense</a></li>
              <li><a href="{% url 'expenses:list' %}" class="block px-3 py-2 rounded-md hover:bg-slate-700">Expense List</a></li>
            </ul>
          </details>
        </div>

        <!-- Reports -->
        <div>
          <h3 class="text-xs text-slate-200 font-semibold uppercase tracking-wider mb-1">Reports</h3>
          <ul class="grid gap-2">
            <li><a href="{% url 'logs:daily' %}" class="block px-3 py-2 rounded-md hover:bg-slate-700"><i class="fa-solid fa-clock-rotate-left mr-2"></i> Daily Logs</a></li>
            <li><a href="{% url 'logs:monthly' %}" class="block px-3 py-2 rounded-md hover:bg-slate-700"><i class="fa-solid fa-calendar-days mr-2"></i> Monthly Logs</a></li>
            <li><a href="{% url 'reports:monthly' %}" class="block px-3 py-2 rounded-md hover:bg-slate-700"><i class="fa-solid fa-chart-line mr-2"></i> Monthly Reports</a></li>
          </ul>
        </div>

        <!-- Ledger -->
        <div>
          <h3 class="text-xs text-slate-200 font-semibold uppercase tracking-wider mb-1">Ledger</h3>
          <a href="{% url 'ledger:index' %}" class="block px-3 py-2 rounded-md hover:bg-slate-700"><i class="fa-solid fa-book mr-2"></i> Ledger</a>
        </div>
      </nav>

      <!-- Footer / Quick actions (sticky at bottom) -->
      <div class="mt-4 pt-4 border-t border-slate-700">
        <div class="flex gap-2 mb-2">
          <a href="{% url 'sales:create_invoice' %}" class="btn btn-sm btn-outline w-full">
            <i class="fa-solid fa-print mr-2"></i> Print Invoice
          </a>
          <button class="btn btn-sm btn-ghost w-full" onclick="backupNow()">
            <i class="fa-solid fa-cloud-arrow-up mr-2"></i> Backup
          </button>
        </div>
        <div class="text-xs text-slate-300">
          <div>Welcome, <span class="font-medium">{{ user.first_name }}</span></div>
          <div class="mt-1">Store: <span class="font-medium">{{ store.name }}</span></div>
        </div>
      </div>
    </aside>
  </div>
</div>

<!-- Minimal JS: filter, active link highlight, backup stub -->
<script>
  // filter product list inside sidebar
  function filterSidebarProducts(query) {
    query = (query || '').trim().toLowerCase();
    const items = document.querySelectorAll('#product-list .product-item');
    items.forEach(li => {
      const text = li.getAttribute('data-name') || '';
      li.style.display = text.includes(query) ? '' : 'none';
    });
  }

  // Optional: highlight active sidebar link based on location
  function highlightActiveLinks() {
    const links = document.querySelectorAll('aside a[href]');
    const path = window.location.pathname;
    links.forEach(a => {
      if (a.getAttribute('href') === path) {
        a.classList.add('bg-slate-700', 'text-sky-300');
      } else {
        a.classList.remove('bg-slate-700', 'text-sky-300');
      }
    });
  }
  document.addEventListener('DOMContentLoaded', highlightActiveLinks);

  // backup action (stub) - replace with real action or Ajax
  function backupNow() {
    // Example: open backup page or call API
    alert('Backup started â€” implement server-side endpoint to perform backup.');
  }
</script>

<!-- Small extra styles for a nicer thin scrollbar (works in modern browsers) -->
<style>
  /* Tailwind utilities do most of the styling; small custom scrollbar */
  .scrollbar-thin {
    scrollbar-width: thin;
  }
  .scrollbar-thumb-slate-600::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  .scrollbar-thumb-slate-600::-webkit-scrollbar-thumb {
    background-color: rgba(148,163,184,0.6);
    border-radius: 8px;
  }
  .scrollbar-track-slate-800::-webkit-scrollbar-track {
    background: transparent;
  }
</style>

    <!-- JavaScript for Theme Toggle and Active Link Highlighting -->
    <script>
        // Theme Toggle (Persists in localStorage)
        (function() {
            const KEY = 'earthshop-theme';
            const html = document.documentElement;
            const btn = document.getElementById('themeToggle');
            const saved = localStorage.getItem(KEY);
            if (saved) html.setAttribute('data-theme', saved);
            const setIcon = () => btn.querySelector('i').className = html.getAttribute('data-theme') === 'dark' ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
            setIcon();
            btn.addEventListener('click', () => {
                const next = html.getAttribute('data-theme') === 'dark' ? 'cupcake' : 'dark';
                html.setAttribute('data-theme', next);
                localStorage.setItem(KEY, next);
                setIcon();
            });
        })();

        // Highlight Active Link and Auto-Open Parent Menu
        (function() {
            const here = location.pathname.replace(/\/+$/, '');
            const links = document.querySelectorAll('.menu a[href]');
            links.forEach(a => {
                const href = a.getAttribute('href');
                if (!href) return;
                const norm = href.replace(/\/+$/, '');
                if (norm && norm === here) {
                    a.classList.add('active');
                    const details = a.closest('details');
                    if (details) details.setAttribute('open', '');
                    const summary = details?.previousElementSibling;
                    if (summary) summary.classList.add('active');
                }
            });
        })();
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>